<h1>Productos / Servicios</h1>

<div class="container principal">
  <div class="row">
    <div class="col-lg-12">
      <a class="registrar-compra-boton boton-nav" href="" data-toggle="modal" data-target="#crearProducto" (click)="limpiarCampos()">
        <svg class="bi bi-plus-circle" style="color: #00B6A2;margin-right: 0.5em;" width="1.3em" height="1.3em"
          viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M8 3.5a.5.5 0 01.5.5v4a.5.5 0 01-.5.5H4a.5.5 0 010-1h3.5V4a.5.5 0 01.5-.5z"
            clip-rule="evenodd" />
          <path fill-rule="evenodd" d="M7.5 8a.5.5 0 01.5-.5h4a.5.5 0 010 1H8.5V12a.5.5 0 01-1 0V8z"
            clip-rule="evenodd" />
          <path fill-rule="evenodd" d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 108 0a8 8 0 000 16z"
            clip-rule="evenodd" />
        </svg> Crear producto o servicio
      </a>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-9">
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <label class="input-group-text" for="categoriaid">Tipo de búsqueda</label>
        </div>
        <select id="categoriaid" class="custom-select" required [(ngModel)]="busqueda.tipo"
          (change)="cambioDeBusqueda()" name="tipoBusqueda" #tipoBusqueda>
          <option value="codigo" selected>Código</option>
          <option value="categoria">Categoría</option>
          <option value="item">Item</option>
        </select>
        <input class="form-control" type="search" required name="codProducto"
          placeholder="{{busqueda.tipo | titlecase}}" [(ngModel)]="busqueda.busqueda" #codProducto>
        <!--<input class="form-control" type="search" required name="codProducto" *ngIf="busqueda.tipo == 'codigo'"
          placeholder="Categoria ID" [(ngModel)]="busqueda.categoriaid" #codProducto> -->
        <div class="input-group-append">
          <button class="btn btn-outline-primary buscar-compra" type="button" (click)="buscar()">
            <svg class="bi bi-search" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
              xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd"
                d="M10.442 10.442a1 1 0 011.415 0l3.85 3.85a1 1 0 01-1.414 1.415l-3.85-3.85a1 1 0 010-1.415z"
                clip-rule="evenodd" />
              <path fill-rule="evenodd"
                d="M6.5 12a5.5 5.5 0 100-11 5.5 5.5 0 000 11zM13 6.5a6.5 6.5 0 11-13 0 6.5 6.5 0 0113 0z"
                clip-rule="evenodd" />
            </svg></button>
        </div>
      </div>
    </div>
    <div class="col-lg-3 listar-button">
      <a class="boton-nav" (click)="buscarTodos()">
        <svg class="bi bi-arrow-repeat" style="color: #00B6A2;margin-right: 0.5em;" width="1.3em" height="1.3em"
          viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd"
            d="M2.854 7.146a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L2.5 8.207l1.646 1.647a.5.5 0 0 0 .708-.708l-2-2zm13-1a.5.5 0 0 0-.708 0L13.5 7.793l-1.646-1.647a.5.5 0 0 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0 0-.708z" />
          <path fill-rule="evenodd"
            d="M8 3a4.995 4.995 0 0 0-4.192 2.273.5.5 0 0 1-.837-.546A6 6 0 0 1 14 8a.5.5 0 0 1-1.001 0 5 5 0 0 0-5-5zM2.5 7.5A.5.5 0 0 1 3 8a5 5 0 0 0 9.192 2.727.5.5 0 1 1 .837.546A6 6 0 0 1 2 8a.5.5 0 0 1 .501-.5z" />

        </svg> Listar todos
      </a>
    </div>
  </div>
</div>

<app-error *ngIf="error"></app-error>
<!--Cards-->

<div class="container cards-container">
  <div class="row cards-row">
    <div class="col-sm-4" *ngFor="let producto of productos;">
      <div class="card card1 mb-2">
        <div class="card-header">{{producto.nombre}}</div>
        <div class="card-body">
          <p class="card-text">ID: {{producto.id}}</p>
          <p class="card-text">{{producto.descripcion}}</p>
          <a class="btn btn-outline-primary" data-toggle="modal" data-target="#modificarProducto"
            (click)="capturar(producto)">Ver detalles</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Crear -->
<div class="modal fade" id="crearProducto" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content" id="ancho">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Crear un producto / servicio</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row">
            <div class="col-sm-6">
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <label class="input-group-text" for="almacenid">Categoría</label>
                </div>
                <select class="custom-select" required [(ngModel)]="nuevoProdSer.idCategoria" name="categoriaId"
                  #categoriaId (change)="listarItems()">
                  <option [ngValue]="null" selected></option>
                  <option value="Nuevo">Casa</option>
                  <option value="Usado">Entretenimiento</option>
                  <option *ngFor="let categoria of categorias" [ngValue]="categoria.id">
                    {{categoria.nombre}}</option>
                </select>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <label class="input-group-text" for="almacenid">Item</label>
                </div>
                <select class="custom-select" required [(ngModel)]="nuevoProdSer.idItem" [disabled]="nuevoProdSer.idCategoria == null" name="itemID" #itemID>
                  <option [ngValue]="null" selected></option>
                  <option *ngFor="let item of items" [ngValue]="item.idItem">
                    {{item.nombre}}</option>
                </select>
              </div>
            </div>
          </div>
          <hr>
          <div class="row">
            <div class="col-sm-12">
              <form>
                <div class="form-group row">
                  <div class="col-sm-6">
                    <label for="nombreCategoria">Nombre</label>
                    <input type="text" class="form-control" placeholder="Nombre del prod/ser" required
                      [(ngModel)]="nuevoProdSer.nombre" name="nombre" #nombred>
                  </div>
                  <div class="col-sm-6">
                    <label for="nombreCategoria">Unidad</label>
                    <input type="text" class="form-control" placeholder="Unidad del prod/ser" required
                      [(ngModel)]="nuevoProdSer.unidad" name="unidad" #unidad>
                  </div>
                </div>
                <div class="form-group">
                  <label for="descripCategoria">Descripción</label>
                  <textarea class="form-control" id="ProdSerDescripcion" [(ngModel)]="nuevoProdSer.descripcion"
                    name="ProdSerDescripcion" rows="3"></textarea>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-primary crearProdSer"
          [disabled]="!(nuevoProdSer.nombre != '') || nuevoProdSer.idCategoria == null || nuevoProdSer.idItem == null"
          (click)="crearProdSer()" data-dismiss="modal">Crear</button>
        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal detalles -->
<div class="modal fade" id="modificarProducto" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content" id="ancho">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Código: {{producto.id}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row">
            <div class="col-sm-6">
              <div class="categoria">
                <h6>Categoría: {{producto.idCategoria}}</h6>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="categoria">
                <h6>Item: {{producto.idItem}}</h6>
              </div>
            </div>
          </div>
          <hr>
          <div class="row">
            <div class="col-sm-12">
              <form>
                <div class="form-group row">
                  <div class="col-sm-6">
                    <label for="nombreCategoria">Nombre</label>
                    <input type="text" class="form-control" value={{producto.nombre}} required
                      [(ngModel)]="prodSerActualizado.nombre" name="nombre">
                  </div>
                  <div class="col-sm-6">
                    <label for="nombreCategoria">Unidad</label>
                    <input type="text" class="form-control" value={{producto.unidad}} required
                      [(ngModel)]="prodSerActualizado.unidad" name="unidad">
                  </div>
                </div>
                <div class="form-group">
                  <label for="descripCategoria">Descripción: {{producto.descripcion}}</label>
                  <textarea class="form-control" placeholder="Nueva descripción" id="descripcion"
                    [(ngModel)]="prodSerActualizado.descripcion" name="descripcion" rows="3"></textarea>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-primary crearProdSer"
          [disabled]="!(prodSerActualizado.nombre != '' || prodSerActualizado.descripcion != '' || prodSerActualizado.unidad != '')" [swal]="confirmarMod"
          data-dismiss="modal">Modificar</button>
      </div>
    </div>
  </div>
</div>

<!-- Alert Para Confirmar la modificación -->
<swal #confirmarMod title="¿Desea guardar los cambios?" icon="question"
    [showCancelButton]="true" [focusCancel]="true" cancelButtonText="Cancelar" confirmButtonText="Guardar"
    (confirm)="modificarProducto()">
</swal>